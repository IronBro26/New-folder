<!DOCTYPE html>
<html>
<head>
  <title>Sign Up / Login</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 80px;
    }
    input {
      margin: 5px;
      padding: 8px;
    }
    button {
      padding: 8px 15px;
      margin: 5px;
      cursor: pointer;
    }
    #userSection {
      display: none;
    }
  </style>
</head>
<body>
  <h2>Sign Up / Login</h2>

  <!-- Login/SignUp Form -->
  <div id="authSection">
    <input type="email" id="email" placeholder="Email">
    <br>
    <input type="password" id="password" placeholder="Password">
    <br>
    <button onclick="signUp()">Sign Up</button>
    <button onclick="login()">Login</button>
  </div>

  <!-- Logged-in User Section -->
  <div id="userSection">
    <h3 id="welcomeMessage"></h3>
    <button onclick="goToWebsite()">Go to Website</button>
    <button onclick="logout()">Log Out</button>
  </div>

  <script>
    // ✅ Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDTw5KYBkamqhvZsCVB9pqm2VTnEaRIdeM",
      authDomain: "ironbro26-ca6e8.firebaseapp.com",
      projectId: "ironbro26-ca6e8",
      storageBucket: "ironbro26-ca6e8.firebasestorage.app",
      messagingSenderId: "260134100377",
      appId: "1:260134100377:web:33d54f6d08d83178190708",
      measurementId: "G-17C00FNW0B"
    };

    // ✅ Initialize Firebase (no imports needed)
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const authSection = document.getElementById('authSection');
    const userSection = document.getElementById('userSection');
    const welcomeMessage = document.getElementById('welcomeMessage');

    async function signUp() {
      const email = emailInput.value;
      const password = passwordInput.value;
      try {
        const userCred = await auth.createUserWithEmailAndPassword(email, password);
        await db.collection('users').doc(userCred.user.uid).set({
          email,
          lastLogin: new Date().toLocaleString(),
          online: true
        });
        alert('Signed up successfully!');
      } catch (err) {
        alert(err.message);
      }
    }

    async function login() {
      const email = emailInput.value;
      const password = passwordInput.value;
      try {
        const userCred = await auth.signInWithEmailAndPassword(email, password);
        await db.collection('users').doc(userCred.user.uid).update({
          lastLogin: new Date().toLocaleString(),
          online: true
        });
        alert('Logged in!');
      } catch (err) {
        alert(err.message);
      }
    }

    async function logout() {
      const user = auth.currentUser;
      if (user) {
        await db.collection('users').doc(user.uid).update({ online: false });
        await auth.signOut();
        alert('Logged out successfully!');
      }
    }

    function goToWebsite() {
      // 🌐 Change this link to your actual website page
      window.location.href = "https://yourwebsite.com";
    }

    auth.onAuthStateChanged(async user => {
      if (user) {
        // Logged in
        authSection.style.display = "none";
        userSection.style.display = "block";
        welcomeMessage.textContent = `Welcome, ${user.email}!`;
        window.addEventListener('beforeunload', async () => {
          await db.collection('users').doc(user.uid).update({ online: false });
        });
      } else {
        // Logged out
        authSection.style.display = "block";
        userSection.style.display = "none";
      }
    });
  </script>
</body>
</html>
