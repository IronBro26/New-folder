<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - IronBro26</title>
<style>
  body {
    background:#0d0d0d;
    color:#fff;
    font-family:Arial,sans-serif;
    margin:0;
    padding:20px;
  }
  h1 { 
    color:#ff1a1a; 
    text-shadow:0 0 10px #ff3333, 0 0 25px #ff6666; 
  }
  a.home-btn {
    display:inline-block;
    padding:10px 20px;
    background:#ff1a1a;
    color:#000;
    font-weight:bold;
    border-radius:8px;
    text-decoration:none;
    box-shadow:0 0 15px #ff4444, 0 0 25px #ff6666;
    margin:15px 0 25px;
    transition:0.3s;
  }
  a.home-btn:hover {
    background:#ff3333;
    box-shadow:0 0 25px #ff6666,0 0 40px #ff9999;
    transform:scale(1.05);
  }
  table {
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
  }
  th, td {
    border:1px solid #ff1a1a;
    padding:10px;
    text-align:left;
  }
  th { background:#ff1a1a; color:#000; }
  td { background:#222; }
</style>
</head>
<body>

<h1>üõ° Admin Panel</h1>

<!-- Home Page Button -->
<a class="home-btn" href="index.html">üè† Go to Home Page</a>

<!-- Accent color picker for site sidebars -->
<div style="margin:18px 0;padding:12px;border-radius:10px;background:linear-gradient(180deg,#0b0b0b,#141414);border:1px solid rgba(255,255,255,0.04);max-width:520px">
  <label for="siteAccentPicker" style="display:block;margin-bottom:8px;color:#ccc;font-weight:600">Site accent color (updates sidebars)</label>
  <input id="siteAccentPicker" type="color" value="#ff1a1a" style="width:56px;height:40px;border:none;padding:0;vertical-align:middle;border-radius:6px;" />
  <button id="applyAccent" style="margin-left:12px;padding:8px 12px;border-radius:8px;background:#222;color:#fff;border:1px solid #444;cursor:pointer">Apply</button>
  <button id="previewAccent" style="margin-left:8px;padding:8px 12px;border-radius:8px;background:#222;color:#fff;border:1px solid #444;cursor:pointer">Preview</button>
  <button id="resetAccent" style="margin-left:8px;padding:8px 12px;border-radius:8px;background:#222;color:#fff;border:1px solid #444;cursor:pointer">Reset</button>
  <div id="accentStatus" style="margin-top:10px;color:#bdbdbd;font-size:13px"></div>
</div>

<h2>Signed Up Users</h2>
<table id="usersTable">
  <tr>
    <th>Email</th>
    <th>Role</th>
    <th>Signed Up At</th>
  </tr>
</table>

<h2>Currently Online Users</h2>
<table id="onlineTable">
  <tr>
    <th>Email</th>
    <th>Last Active</th>
  </tr>
</table>

<script>
  // Only allow admin access
  const currentUser = JSON.parse(localStorage.getItem("currentUser"));
  if(!currentUser || currentUser.role !== "admin") {
    alert("Access Denied! Only admins can access this page.");
    window.location.href = "signup.html"; // redirect non-admins
  }

  // Get all users
  let allUsers = JSON.parse(localStorage.getItem("users") || "[]");
  const usersTable = document.getElementById("usersTable");

  allUsers.forEach(user => {
    let row = usersTable.insertRow();
    row.insertCell(0).innerText = user.email;
    row.insertCell(1).innerText = user.role || "user";
    row.insertCell(2).innerText = user.timestamp || "N/A";
  });

  // Online user tracking
  let onlineUsers = JSON.parse(localStorage.getItem("onlineUsers") || "[]");
  const now = new Date().toLocaleString();
  const existing = onlineUsers.find(u => u.email === currentUser.email);
  if(!existing) {
    onlineUsers.push({email: currentUser.email, lastActive: now});
  } else {
    existing.lastActive = now;
  }
  localStorage.setItem("onlineUsers", JSON.stringify(onlineUsers));

  function renderOnline() {
    const onlineTable = document.getElementById("onlineTable");
    onlineTable.innerHTML = "<tr><th>Email</th><th>Last Active</th></tr>";
    onlineUsers.forEach(user => {
      let row = onlineTable.insertRow();
      row.insertCell(0).innerText = user.email;
      row.insertCell(1).innerText = user.lastActive;
    });
  }
  renderOnline();

  // Remove user when tab closes
  window.addEventListener("beforeunload", ()=>{
    onlineUsers = onlineUsers.filter(u => u.email !== currentUser.email);
    localStorage.setItem("onlineUsers", JSON.stringify(onlineUsers));
  });
</script>

<!-- Accent Picker Handler -->
<script>
  document.addEventListener('DOMContentLoaded', function(){
    try {
      const picker = document.getElementById('siteAccentPicker');
      const applyBtn = document.getElementById('applyAccent');
      const resetBtn = document.getElementById('resetAccent');
      const status = document.getElementById('accentStatus');

      try {
        const saved = localStorage.getItem('siteAccent');
        if (saved && picker) picker.value = saved;
      } catch(e){}

      function broadcastAccent(accent, openPreview) {
        try { if (accent) localStorage.setItem('siteAccent', accent); else localStorage.removeItem('siteAccent'); } catch(e){}
        try { window.dispatchEvent(new CustomEvent('siteAccentChanged', { detail: { accent } })); } catch(e){}
        try { document.dispatchEvent(new CustomEvent('siteAccentChanged', { detail: { accent } })); } catch(e){}
        if (status) status.textContent = accent ? ('Accent set to ' + accent) : 'Accent cleared (default)';
        if (openPreview) {
          const previewWin = window.open('./index.html', 'site-preview');
          if (previewWin && typeof previewWin.focus === 'function') previewWin.focus();
        }
      }

      applyBtn?.addEventListener('click', ()=>broadcastAccent(picker.value, false));
      document.getElementById('previewAccent')?.addEventListener('click', ()=>broadcastAccent(picker.value, true));
      resetBtn?.addEventListener('click', ()=>{ broadcastAccent(null); picker.value = '#ff1a1a'; });
    } catch (err) {
      console.warn('Accent picker init failed', err);
    }
  });
</script>

</body>
</html>
