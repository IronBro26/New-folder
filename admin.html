<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ADMIN CONTROL PANEL</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#000;
    --neon:#ff0033;
    --glow: rgba(255,0,51,0.12);
    --neon-green: #00ff88;
  }
  html,body{height:100%; margin:0; background: #000; color:var(--neon); font-family:'Orbitron', sans-serif;}
  body{display:flex; align-items:center; justify-content:center; padding:28px;}

  .container{
    width:1000px; max-width:96%; border-radius:14px; padding:18px; background: linear-gradient(180deg, rgba(255,0,51,0.02), rgba(0,0,0,0.6));
    border:1px solid rgba(255,0,51,0.08); box-shadow:0 20px 80px rgba(255,0,51,0.03);
  }

  .header{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    margin-bottom:16px;
  }
  .h-title{
    font-family:'Press Start 2P', 'Orbitron';
    font-size:20px; color:var(--neon);
    text-shadow: 0 0 14px rgba(255,0,51,0.9), 0 0 60px rgba(255,0,51,0.12);
    animation: flicker 2.2s infinite;
  }
  @keyframes flicker{
    0%{opacity:0.95} 50%{opacity:1} 55%{opacity:0.8} 100%{opacity:0.98}
  }

  .controls{display:flex; gap:10px; align-items:center;}
  .btn{
    padding:8px 12px; border-radius:8px; background:linear-gradient(180deg, rgba(255,0,51,0.06), transparent); border:1px solid rgba(255,0,51,0.12);
    color:white; font-weight:700; cursor:pointer;
  }

  .panel{
    border-radius:10px; padding:12px; border:1px solid rgba(255,0,51,0.06); background:rgba(0,0,0,0.45);
  }

  table{width:100%; border-collapse:collapse; font-size:13px;}
  th,td{padding:10px 8px; text-align:left; border-bottom:1px dashed rgba(255,0,51,0.04);}
  th{font-size:12px; color:rgba(255,255,255,0.8); text-transform:uppercase; letter-spacing:1px;}
  td{color:rgba(255,255,255,0.88);}

  .dot{width:14px;height:14px;border-radius:50%;display:inline-block;margin-right:8px;vertical-align:middle}
  .online{background:var(--neon-green); box-shadow:0 0 18px rgba(0,255,136,0.12)}
  .offline{background:var(--neon); box-shadow:0 0 18px rgba(255,0,51,0.12)}

  .muted{color:rgba(255,255,255,0.55); font-size:12px}
  .center{display:flex; justify-content:center; align-items:center}

  @media (max-width:860px){ body{padding:12px} .header{flex-direction:column; gap:8px}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <div class="h-title">ADMIN CONTROL PANEL</div>
      <div class="muted">Realtime users (from <code>neon_users</code>) â€” refreshes automatically and via storage events</div>
    </div>
    <div class="controls">
      <a class="btn" href="file:///C:/Users/Krfuc/OneDrive/Website/New%20folder/index.html" target="_blank">Home</a>
      <button id="btn-refresh" class="btn">Data Sync</button>
      <button id="btn-logout" class="btn">Logout (Admin)</button>
    </div>
  </div>

  <div class="panel">
    <table id="users-table" aria-live="polite">
      <thead>
        <tr>
          <th>Email</th>
          <th>Passcode</th>
          <th>Signup Time</th>
          <th>Online Status</th>
          <th>Last Online</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="no-users" class="center" style="padding:14px; display:none; color:rgba(255,255,255,0.6)">No users found</div>
  </div>
</div>

<script>
const USERS_KEY = "neon_users";
const CURRENT_KEY = "neon_current";

/* Formatting */
function nowFormatted(){
  const d = new Date();
  const Y = d.getFullYear();
  const M = String(d.getMonth()+1).padStart(2,'0');
  const D = String(d.getDate()).padStart(2,'0');
  const h = String(d.getHours()).padStart(2,'0');
  const m = String(d.getMinutes()).padStart(2,'0');
  return `${Y}-${M}-${D} ${h}:${m}`;
}
function loadUsers(){ try { return JSON.parse(localStorage.getItem(USERS_KEY) || "[]"); } catch(e){ return []; } }
function saveUsers(arr){ localStorage.setItem(USERS_KEY, JSON.stringify(arr)); }

/* Access control: only Owner (Krfuchs@icloud.com) allowed */
const current = sessionStorage.getItem(CURRENT_KEY);
if(!current || current.toLowerCase() !== 'krfuchs@icloud.com'){
  alert('Access Denied: Admins Only.');
  // small delay so alert reads, then redirect:
  window.location.href = 'signup.html';
} else {
  // owner is present: proceed
  init();
}

function init(){
  renderTable();
  // refresh every 3 seconds
  setInterval(renderTable, 3000);

  // Listen for storage updates to reflect other tabs' changes
  window.addEventListener('storage', (e)=>{
    if(e.key === USERS_KEY || e.key === 'neon_last_activity'){
      renderTable();
      // subtle flash
      document.querySelector('.h-title').style.transform = 'translateY(-2px)';
      setTimeout(()=> document.querySelector('.h-title').style.transform = '', 220);
    }
  });

  document.getElementById('btn-refresh').addEventListener('click', ()=> renderTable());
  document.getElementById('btn-logout').addEventListener('click', ()=>{
    // Owner logout: mark offline and clear session
    const users = loadUsers();
    const idx = users.findIndex(u => u.email.toLowerCase() === 'krfuchs@icloud.com');
    if(idx !== -1){
      users[idx].online = false;
      users[idx].lastOnline = nowFormatted();
      saveUsers(users);
    }
    sessionStorage.removeItem(CURRENT_KEY);
    // notify other tabs
    localStorage.setItem('neon_last_activity', Date.now().toString());
    // redirect back to signup
    window.location.href = 'signup.html';
  });
}

function renderTable(){
  const tbody = document.querySelector('#users-table tbody');
  const noUsers = document.getElementById('no-users');
  const users = loadUsers();
  tbody.innerHTML = '';
  if(!users || users.length === 0){
    noUsers.style.display = 'block';
    return;
  } else noUsers.style.display = 'none';

  users.forEach(u=>{
    const tr = document.createElement('tr');
    const emailTd = document.createElement('td');
    emailTd.textContent = u.email;
    const passTd = document.createElement('td');
    passTd.textContent = u.passcode;
    const signupTd = document.createElement('td');
    signupTd.textContent = u.signupTime || '-';
    const onlineTd = document.createElement('td');
    const dot = document.createElement('span');
    dot.className = 'dot ' + (u.online ? 'online' : 'offline');
    const txt = document.createElement('span');
    txt.textContent = u.online ? 'Online' : 'Offline';
    onlineTd.appendChild(dot);
    onlineTd.appendChild(txt);
    const lastTd = document.createElement('td');
    lastTd.textContent = u.lastOnline || '-';

    tr.appendChild(emailTd);
    tr.appendChild(passTd);
    tr.appendChild(signupTd);
    tr.appendChild(onlineTd);
    tr.appendChild(lastTd);
    tbody.appendChild(tr);
  });
}

/* optional: allow admin to force toggle a user's online state by clicking a row (convenience) */
document.addEventListener('click', (e)=>{
  const row = e.target.closest('tr');
  if(!row) return;
  const cells = row.querySelectorAll('td');
  if(cells.length < 1) return;
  const email = cells[0].innerText;
  // prevent accidental toggle when clicking header
  if(email.toLowerCase() === 'email') return;
  // confirm action
  if(!confirm(`Toggle online status for ${email}?`)) return;
  const users = loadUsers();
  const idx = users.findIndex(u => u.email === email);
  if(idx !== -1){
    users[idx].online = !users[idx].online;
    users[idx].lastOnline = nowFormatted();
    saveUsers(users);
    localStorage.setItem('neon_last_activity', Date.now().toString());
    renderTable();
  }
});
</script>
</body>
</html>
